import matplotlib.pyplot as plt
import matplotlib.animation as animation

# 195 个城市坐标，来自 rat195_ga.tsp（键使用 1..195）
data = {
    1: (3, 12), 2: (17, 12), 3: (23, 9), 4: (34, 11), 5: (47, 11), 6: (54, 12), 7: (66, 16), 8: (75, 7),
    9: (86, 6), 10: (94, 8), 11: (107, 9), 12: (115, 14), 13: (123, 15), 14: (3, 32), 15: (15, 32),
    16: (26, 34), 17: (33, 34), 18: (42, 34), 19: (53, 25), 20: (64, 32), 21: (74, 32), 22: (85, 34),
    23: (95, 28), 24: (104, 25), 25: (113, 31), 26: (125, 34), 27: (3, 48), 28: (15, 46), 29: (26, 50),
    30: (36, 54), 31: (48, 50), 32: (54, 46), 33: (64, 54), 34: (75, 44), 35: (88, 49), 36: (98, 50),
    37: (103, 54), 38: (115, 47), 39: (127, 49), 40: (6, 75), 41: (15, 75), 42: (27, 73), 43: (36, 73),
    44: (47, 68), 45: (54, 72), 46: (66, 68), 47: (74, 67), 48: (85, 65), 49: (94, 74), 50: (107, 65),
    51: (117, 65), 52: (125, 68), 53: (6, 84), 54: (13, 95), 55: (25, 94), 56: (37, 84), 57: (47, 87),
    58: (53, 95), 59: (63, 86), 60: (77, 93), 61: (83, 89), 62: (94, 95), 63: (103, 92), 64: (115, 95),
    65: (123, 93), 66: (7, 114), 67: (15, 111), 68: (24, 112), 69: (36, 108), 70: (43, 112), 71: (56, 105),
    72: (64, 112), 73: (73, 112), 74: (86, 107), 75: (98, 108), 76: (104, 113), 77: (117, 115), 78: (126, 109),
    79: (6, 127), 80: (17, 125), 81: (27, 134), 82: (35, 126), 83: (44, 131), 84: (54, 132), 85: (63, 124),
    86: (77, 127), 87: (82, 134), 88: (96, 128), 89: (103, 126), 90: (116, 130), 91: (126, 134), 92: (7, 152),
    93: (16, 147), 94: (24, 153), 95: (35, 151), 96: (45, 154), 97: (55, 146), 98: (63, 155), 99: (75, 151),
    100: (87, 154), 101: (93, 156), 102: (104, 151), 103: (117, 153), 104: (127, 148), 105: (3, 164),
    106: (16, 172), 107: (25, 165), 108: (35, 175), 109: (44, 169), 110: (53, 174), 111: (64, 168),
    112: (76, 171), 113: (87, 173), 114: (95, 174), 115: (106, 168), 116: (114, 169), 117: (125, 169),
    118: (3, 190), 119: (16, 188), 120: (25, 195), 121: (37, 186), 122: (44, 189), 123: (54, 194),
    124: (66, 192), 125: (77, 192), 126: (85, 188), 127: (93, 185), 128: (106, 192), 129: (113, 193),
    130: (125, 195), 131: (5, 207), 132: (15, 213), 133: (24, 209), 134: (33, 214), 135: (43, 206),
    136: (53, 211), 137: (64, 213), 138: (74, 212), 139: (84, 212), 140: (94, 209), 141: (104, 215),
    142: (115, 206), 143: (127, 209), 144: (6, 229), 145: (13, 227), 146: (26, 235), 147: (34, 225),
    148: (43, 227), 149: (55, 225), 150: (67, 229), 151: (75, 234), 152: (87, 230), 153: (95, 235),
    154: (105, 228), 155: (117, 225), 156: (127, 230), 157: (6, 249), 158: (15, 246), 159: (26, 255),
    160: (33, 246), 161: (47, 248), 162: (58, 252), 163: (65, 248), 164: (73, 247), 165: (87, 249),
    166: (94, 245), 167: (104, 256), 168: (113, 246), 169: (125, 253), 170: (5, 266), 171: (16, 274),
    172: (24, 267), 173: (37, 266), 174: (45, 267), 175: (54, 266), 176: (67, 267), 177: (74, 265),
    178: (87, 264), 179: (95, 271), 180: (106, 264), 181: (116, 271), 182: (127, 273), 183: (7, 287),
    184: (17, 294), 185: (23, 287), 186: (33, 284), 187: (43, 288), 188: (53, 295), 189: (67, 288),
    190: (73, 286), 191: (87, 293), 192: (94, 284), 193: (104, 291), 194: (114, 294), 195: (127, 290),
}

# rat195_ga.tsp 中给出的 Tour order（0 基准）
tour_zero_based = [0, 30, 31, 32, 45, 46, 47, 48, 49, 50, 51, 38, 37, 35, 34, 33, 20, 19, 6, 7, 8, 9, 10, 11, 12, 25, 24, 23, 22, 21, 36, 114, 115, 116, 129, 128, 127, 141, 142, 154, 155, 153, 140, 139, 138, 137, 136, 135, 134, 132, 133, 146, 147, 148, 149, 150, 151, 152, 165, 164, 163, 162, 161, 160, 159, 158, 171, 172, 173, 174, 175, 176, 177, 178, 179, 166, 167, 168, 180, 181, 194, 193, 192, 191, 190, 189, 188, 187, 186, 185, 184, 183, 182, 170, 169, 156, 157, 145, 144, 143, 131, 130, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 113, 112, 111, 110, 97, 96, 95, 94, 93, 92, 91, 104, 105, 106, 107, 108, 109, 98, 99, 100, 101, 102, 103, 90, 89, 88, 87, 86, 85, 84, 71, 72, 73, 74, 75, 76, 77, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 42, 41, 40, 39, 52, 53, 54, 67, 66, 65, 78, 79, 80, 81, 82, 83, 69, 68, 70, 44, 43, 29, 28, 27, 26, 13, 14, 15, 16, 17, 18, 5, 4, 3, 2, 1]

# 转换为 1 基准并闭合回路（在末尾追加起点）
best_path = [v + 1 for v in tour_zero_based]
best_path.append(best_path[0])

def plot_tour(data, best_path, is_save=False, gif_name="rat195_ga.gif", fps=3):
    """
    自包含绘制并可保存 GIF（与其它 *_ga 脚本逻辑一致）
    """
    fig, ax = plt.subplots(figsize=(8, 6))
    xs = [c[0] for c in data.values()]
    ys = [c[1] for c in data.values()]
    ax.set_xlim(min(xs) - 5, max(xs) + 5)
    ax.set_ylim(min(ys) - 5, max(ys) + 5)
    ax.set_xlabel("X")
    ax.set_ylabel("Y")
    ax.set_title("RAT195 GA tour")

    x_seq = []
    y_seq = []
    frames = []
    for v in best_path:
        x_seq.append(data[v][0])
        y_seq.append(data[v][1])

        pts = ax.plot(x_seq, y_seq, 'c^', markersize=4)
        txt = ax.text(data[v][0], data[v][1], str(v), ha='center', va='center_baseline', size=6)
        line = ax.plot(x_seq, y_seq, '--', linewidth=1, color='gray')
        frames.append(pts + line + [txt])

    ani = animation.ArtistAnimation(fig, frames, interval=int(1000/fps), repeat_delay=0)
    if is_save:
        ani.save(gif_name, writer='pillow', fps=fps)
    plt.show()

if __name__ == "__main__":
    # 运行并保存 rat195_ga.gif
    plot_tour(data, best_path, True)
