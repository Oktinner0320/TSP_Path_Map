import matplotlib.pyplot as plt
import matplotlib.animation as animation

# 120 个城市坐标，来自 gr120_ga.tsp DISPLAY_DATA_SECTION（键使用 1..120）
data = {
    1: (8.0, 124.0), 2: (125.0, 80.0), 3: (97.0, 74.0), 4: (69.0, 96.0), 5: (106.0, 46.0),
    6: (49.0, 57.0), 7: (80.0, 125.0), 8: (42.0, 93.0), 9: (104.0, 94.0), 10: (35.0, 17.0),
    11: (118.0, 96.0), 12: (151.0, 22.0), 13: (154.0, 182.0), 14: (57.0, 165.0), 15: (18.0, 159.0),
    16: (27.0, 123.0), 17: (96.0, 170.0), 18: (63.0, 198.0), 19: (59.0, 211.0), 20: (88.0, 182.0),
    21: (142.0, 72.0), 22: (48.0, 190.0), 23: (106.0, 106.0), 24: (28.0, 102.0), 25: (63.0, 224.0),
    26: (58.0, 93.0), 27: (103.0, 56.0), 28: (38.0, 149.0), 29: (23.0, 138.0), 30: (22.0, 146.0),
    31: (32.0, 208.0), 32: (27.0, 144.0), 33: (75.0, 258.0), 34: (59.0, 101.0), 35: (41.0, 32.0),
    36: (53.0, 46.0), 37: (76.0, 19.0), 38: (79.0, 115.0), 39: (109.0, 13.0), 40: (59.0, 118.0),
    41: (84.0, 147.0), 42: (95.0, 160.0), 43: (87.0, 213.0), 44: (73.0, 166.0), 45: (43.0, 153.0),
    46: (81.0, 175.0), 47: (59.0, 77.0), 48: (70.0, 68.0), 49: (106.0, 169.0), 50: (86.0, 168.0),
    51: (127.0, 109.0), 52: (68.0, 243.0), 53: (116.0, 57.0), 54: (39.0, 78.0), 55: (54.0, 65.0),
    56: (77.0, 141.0), 57: (95.0, 24.0), 58: (89.0, 238.0), 59: (9.0, 158.0), 60: (39.0, 109.0),
    61: (25.0, 129.0), 62: (69.0, 20.0), 63: (104.0, 34.0), 64: (132.0, 51.0), 65: (98.0, 207.0),
    66: (37.0, 203.0), 67: (80.0, 16.0), 68: (103.0, 224.0), 69: (94.0, 202.0), 70: (49.0, 96.0),
    71: (55.0, 80.0), 72: (62.0, 123.0), 73: (91.0, 31.0), 74: (51.0, 142.0), 75: (64.0, 172.0),
    76: (14.0, 138.0), 77: (120.0, 37.0), 78: (38.0, 160.0), 79: (86.0, 230.0), 80: (96.0, 59.0),
    81: (33.0, 177.0), 82: (108.0, 78.0), 83: (93.0, 12.0), 84: (43.0, 47.0), 85: (52.0, 200.0),
    86: (48.0, 171.0), 87: (62.0, 153.0), 88: (159.0, 53.0), 89: (60.0, 60.0), 90: (36.0, 73.0),
    91: (111.0, 243.0), 92: (31.0, 150.0), 93: (130.0, 67.0), 94: (36.0, 172.0), 95: (132.0, 28.0),
    96: (29.0, 73.0), 97: (150.0, 28.0), 98: (89.0, 166.0), 99: (58.0, 21.0), 100: (78.0, 244.0),
    101: (82.0, 58.0), 102: (81.0, 68.0), 103: (92.0, 98.0), 104: (56.0, 33.0), 105: (47.0, 126.0),
    106: (70.0, 34.0), 107: (78.0, 195.0), 108: (77.0, 215.0), 109: (140.0, 62.0), 110: (70.0, 57.0),
    111: (16.0, 89.0), 112: (66.0, 50.0), 113: (98.0, 194.0), 114: (87.0, 45.0), 115: (132.0, 87.0),
    116: (52.0, 99.0), 117: (50.0, 212.0), 118: (103.0, 176.0), 119: (84.0, 91.0), 120: (31.0, 140.0)
}

# gr120_ga.tsp 中给出的 Tour order（0 基准）
tour_zero_based = [0, 44, 77, 93, 80, 85, 13, 86, 43, 74, 45, 49, 97, 41, 16, 117, 48, 19, 106, 68, 64, 42, 107, 24, 18, 84, 21, 65, 30, 116, 17, 112, 67, 78, 57, 99, 32, 51, 90, 12, 50, 10, 114, 1, 81, 2, 79, 26, 4, 62, 72, 56, 82, 66, 36, 61, 98, 34, 9, 103, 105, 113, 76, 63, 108, 92, 20, 87, 96, 11, 94, 38, 52, 8, 22, 102, 118, 3, 37, 6, 55, 40, 71, 39, 104, 73, 88, 54, 5, 83, 35, 111, 109, 100, 101, 47, 46, 70, 25, 33, 115, 69, 7, 53, 89, 95, 110, 23, 59, 15, 60, 28, 29, 14, 58, 31, 91, 27, 119, 75]

# 转换为 1 基准并闭合回路（在末尾追加起点）
best_path = [v + 1 for v in tour_zero_based]
best_path.append(best_path[0])

def plot_tour(data, best_path, is_save=False, gif_name="gr120_ga.gif", fps=3):
    """
    绘制旅行图（自包含，与 bays29/ulysses16/gr120 保持一致的逻辑）
    """
    fig, ax = plt.subplots(figsize=(8, 6))
    xs = [c[0] for c in data.values()]
    ys = [c[1] for c in data.values()]
    ax.set_xlim(min(xs) - 10, max(xs) + 10)
    ax.set_ylim(min(ys) - 10, max(ys) + 10)
    ax.set_xlabel("X")
    ax.set_ylabel("Y")
    ax.set_title("GR120 GA tour")

    x_seq = []
    y_seq = []
    frames = []
    for v in best_path:
        x_seq.append(data[v][0])
        y_seq.append(data[v][1])

        pts = ax.plot(x_seq, y_seq, 'c^', markersize=6)
        txt = ax.text(data[v][0], data[v][1], str(v), ha='center', va='center_baseline', size=6)
        line = ax.plot(x_seq, y_seq, '--', linewidth=1, color='gray')

        frames.append(pts + line + [txt])

    ani = animation.ArtistAnimation(fig, frames, interval=int(1000/fps), repeat_delay=0)
    if is_save:
        ani.save(gif_name, writer='pillow', fps=fps)
    plt.show()

if __name__ == "__main__":
    plot_tour(data, best_path, True)
